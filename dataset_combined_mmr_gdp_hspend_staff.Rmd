---
title: "gdp_hspend"
author: "Duzhi Zhao"
date: "11/19/2019"
output: github_document
editor_options: 
  chunk_output_type: console
---
# Dataset: MMR vs GDP PER CAPITA
```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
library(readxl)

knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 8, 
  fig.height = 6,
  out.width = "100%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## Import dataset
```{r}
# Maternal Mortality Ratio: number of maternal deaths during a given time period per 100,000 live births during the same time period.
# MMR measures the obsteric risk a women is facing when she is pregnant. 
# E.g. 1575 per 100,000 live births (Afghanistan) vs. 5 per 100,000 live births (Sweden) means a women in Afghanistan is facing a 315 times higher risk of maternal death when she is pregnant than a woman in Swedan. 
mmr_gdp_capita = read_csv("./data/maternal-mortality-ratio-vs-gdp-per-capita.csv") %>%
  janitor::clean_names() %>% 
  rename(
    country = entity,
    mmr = maternal_mortality_ratio_deaths_per_100_000_live_births,
    gdp_per_capita = gdp_per_capita_international,
    gdp = x6) %>% 
  mutate(
    country = as.factor(country),
    code = as.factor(code)
  ) %>% 
  mutate(
    gdp_per_capita = round(gdp_per_capita, digits = 2)
  ) %>% 
  filter(year > 1999, year < 2016)

summary(is.na(mmr_gdp_capita$mmr)) # 945 NA, 3435 non-NA
summary(is.na(mmr_gdp_capita$gdp_per_capita)) # 845 NA, 3535 non-NA
summary(is.na(mmr_gdp_capita$gdp)) # 750 NA, 3630 non-NA
```

## log-transformed 'gdp_per_capita'
```{r}
# log-transformed
mmr_gdp_capita_log = 
  mmr_gdp_capita %>% 
  mutate(
    ln_gdp_per_capita = round(log(gdp_per_capita), digits = 2)
  )
```

## ggplot (year = 2015): linear + log
```{r}
mmr_gdp_capita_log %>% 
  filter(year == 2015) %>% 
  ggplot(aes(x = gdp_per_capita, y = mmr)) + 
  geom_point() +
  labs(x = "GDP per capita ($)",
       y = "Maternal Mortality Ratio per 100,000 live births",
       title = "Maternal Mortality Ratio vs. GDP per capita, 2015")

mmr_gdp_capita_log %>% 
  filter(year == 2015) %>% 
  ggplot(aes(x = ln_gdp_per_capita, y = mmr)) + 
  geom_point() +
  labs(x = "ln(GDP per capita)",
       y = "Maternal Mortality Ratio per 100,000 live births",
       title = "Maternal Mortality Ratio vs. ln(GDP per capita), 2015")

```

# Healthcare spending (%GDP) vs. Country

# import and clean data
```{r}
# Percent GDP that comes from health spending
health_spending_percent_gdp = read_csv("./data/WorldBank/health_spending_percent_GDP.csv") %>%
  janitor::clean_names() %>% 
  select(country_name, country_code, x2000:x2015) %>% 
  pivot_longer(
  x2000:x2015,
  names_to = "year",
  values_to = "health_spending_percent_GDP") %>% 
  mutate(year = str_remove(year,"x")) %>% 
  mutate(health_spending_percent_GDP = round(health_spending_percent_GDP, digits = 2)) %>% 
  mutate(country_name = as.factor(country_name),
         country_code = as.factor(country_code),
         year = as.numeric(year)) %>% 
  rename(country = country_name,
         code = country_code)
```

# plot a scatter plot, country on the x axis, percent GDP spend on healthcare on the y axis
```{r}
latest_health_spending_scatter = 
  health_spending_percent_gdp %>% 
  ggplot(aes(x = country, y = health_spending_percent_GDP)) + 
  geom_point()
```

# log-transformed 'health_spending_percent_GDP'
```{r}
# log-transformed
health_spending_percent_GDP_log = 
  health_spending_percent_gdp %>% 
  mutate(
    ln_health_spending = round(log(health_spending_percent_GDP), digits = 2)
  )
```

```{r}
## ggplot (year = 2015): linear + log
health_spending_percent_GDP_log %>% 
  filter(year == 2015) %>% 
  ggplot(aes(x = country, y = health_spending_percent_GDP)) + 
  geom_point() +
  labs(x = "Country",
       y = "Percent GDP That Comes From Healthcare Spending(%)",
       title = "Different Amount of Healthcare Spending Across Countries")

health_spending_percent_GDP_log %>% 
  filter(year == 2015) %>% 
  ggplot(aes(x = country, y = ln_health_spending)) + 
  geom_point() +
  labs(x = "Country",
       y = "Natural Log Transformed Percent GDP That Comes From Healthcare Spending(%)",
       title = "Different Amount of Healthcare Spending Across Countries")
```

# Health staff
```{r}
#births attended by skilled health staff (percent of total)
staff = read_csv("./data/Gapminder/births_attended_by_skilled_health_staff_percent_of_total.csv")  %>% 
  janitor::clean_names() %>% 
  select(country, x2000:x2017) %>% 
  pivot_longer(
    x2000:x2017,
    names_to = "year",
    values_to = "perc_births_attended"
  ) %>% 
  mutate(year = str_remove(year,"x")) %>% 
  mutate(year = as.numeric(year))
```

# Combined dataset (MMR, GDP per capita, %Healthcare spending, %birth attended by staffs)
```{r}
mmr_gdp_hspend = 
  full_join(mmr_gdp_capita_log, health_spending_percent_gdp, by = c("year", "country", "code"))

mmr_combined = 
  full_join(mmr_gdp_hspend, staff, by = c("year", "country"))

summary(is.na(mmr_combined))
```





```{r explore_matmort_birthsattended}
#This code is incomplete, I was just exploring a bit:
  
mortality_births_attend = inner_join(maternal_mort, staff, by = c("country","year")) 

  
 view(mortality_births_attend) 
  

  
#This is the process I would follow for merging the datasets for gdp sepnding, healthcare spending, and individual cost  (except this is done for the births attended here)
  
  maternal_mort_leading = maternal_mort %>%
  filter(year=='2013') %>% 
  filter(country %in% c("United States", "United Kingdom", "Finland", "Canada","Germany", "New Zealand", "Norway", "China", "Netherlands", "Switzerland", "Singapore", "Japan", "Luxembourg", "Hong Kong", "Qatar"))
  
view(maternal_mort_leading)


leading_2013 = left_join(maternal_mort_leading,staff, by = c("country","year"))

view(leading_2013)

```

