---
title: "Report"

output: 
 html_document:
   theme: lumen
---

```{r setup, include = FALSE}
library(tidyverse)
library(rvest)
library(plotly)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```



## Introduction

The United States has one of the highest maternal mortality rate out of developed countries despite high levels of spending. What are the underlying reasons for this? According to the CDC, Maternal Mortality Ratio is defined as the number of pregnancy-related deaths per 100,000 live births in a certain period of time. The CDC reports that in 2016 alone, the US had 16.8 deaths per 100,000 live births compared to 8.6 in the UK. The UK seems to have achieved these results while spending half than what the US spends in healthcare. As a team, we are interested in assessing the maternal mortality ratio against different determining factors to try to understand why the US lags behind other developed nations on this front.


## Data

The data for this project was collected from several sources:

### US Data

The expected cost to the mother of giving birth was scrapped from the following [Business Insider Article](https://www.businessinsider.com/how-much-does-it-cost-to-have-a-baby-2018-4#50-alabama-1). All data for the birth rates and cesearan rates in the US was pulled from the Center for Disease Control and Prevention and can be found at [CDC WONDER](https://wonder.cdc.gov/natality.html). Maternal mortality ratio within the US was derived using the number of maternal deaths, which is also available at from an underlying cause of death dataset at [CDC WONDER](https://wonder.cdc.gov/ucd-icd10.html).


### Global Data

The percent of births attended by a skilled physician was downloaded directly from [Gap Minder](https://www.gapminder.org/data/) which is a collection of datasets from several sources including the World Health Organization. GDP per capita was collected from [World Development Indicators](https://www.gapminder.org/data/documentation/). Global healthcare spending or expenditures were collected from [The World Bank](https://data.worldbank.org/indicator/SH.XPD.CHEX.GD.ZS?end=2016&start=2000&view=chart). Cost to the mother was extrapolated from the [International Federation of Health Plans](http://www.ifhp.com/).


## Methods


### Maternal Mortality
The World Health Organization defines Maternal Mortality Ratio (MMR) as the number of maternal deaths per 100,000 births. Since the ratio of maternal death to birth is relatively small, this scaling factor helps to make the data more readable for a human viewer. The global data for MMR was downloaded from [Gap Minder](https://www.gapminder.org/data/).

To clean the global MMR data for use, the data was pivoted from wide to long format. It is also worthwhile to note that this dataset contains data dating back to the 1800s and therefore has many missing values. This is nt a problem for our research intentions since we are not fitting regression models for the scope of this problem and therefore we chose to exclude missing values where necessary.

```{r MMR_global, results=FALSE, message=FALSE}
#Maternal Mortality ratio from gapminder dataset
maternal_mort = read_csv("./data/Gapminder/maternal_mortality_ratio_per_100000_live_births.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    x1800:x2013,
    names_to = "year",
    values_to = "maternal_mortality"
  ) %>% 
  mutate(year = str_remove(year,"x"))
```


The Maternal Mortality ratios in the US were not directly available. To circumvent this, we used the number of maternal deaths per state and divided this by the number of births per state to get a ratio of maternal deaths per birth. Then, we scaled this number by multiplying by 100,000 which gives the number of maternal death per 100,000 births for consistency with the statistics reported by the World Health Organization.



****** Kay needs to add this code chunk after she finishes the shiny part *****

### Percent Births Attended By Skilled Health Staff

The percent of births attended by skilled health staff is more explicitly defined as the percentage of deliveries attended by personnel trained to give the necessary supervision, care, and treatment to women during pregnancy, labor, and the postpatrum period. The percent births attended by skilled health staff was taken directly from the aforementioned [Gap Minder](https://www.gapminder.org/data/) dataset. Noteably, this dataset has fewer missing vallues than the MMR dataset, but once again missing values were excluded when necessary.  No complex data manipulation was needed and the following code was used to read in and clean the data:


```{r Births_Attended_SkilledHealthStaff, message=FALSE}
#births attended by skilled health staff (percent of total)
staff = read_csv("./data/Gapminder/births_attended_by_skilled_health_staff_percent_of_total.csv")  %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    x1984:x2017,
    names_to = "year",
    values_to = "perc_births_attended"
  ) %>% 
  mutate(year = str_remove(year,"x"))
```


Both the maternal mortality ratio and births attended by skilled personnel datasets were combined using inner_join.

```{r combine_MMR_attended, message=FALSE}
mortality_births_attend = inner_join(maternal_mort, staff, by = c("country","year"))
```

Since percent births attended by a skilled personnel is a continuous variable, we built a factor `per_range` variable that takes values from 0-100 percent and divide them into four discrete bins. 0-25, 26-50, 51-75, and 76-100 respectively. This new factor variable is then used to plot an interactive boxplot of maternal mortality ratio versus the bins of percent births attended by skilled personnel. To examine whether there was a cutoff past which the percent of births attended by a skilled health physician was no longer a significant factor, we also took a closer look at the countries in this high 76-100% attendance bin.


```{r bin_0to100percent, message=FALSE}
mortality_births_attend = 
mortality_births_attend %>% 
  drop_na() %>% 
  mutate(
    per_range = case_when(
      perc_births_attended <= 25 ~ "0-25",
      perc_births_attended <= 50 ~ "26-50",
      perc_births_attended <= 75 ~ "51-75",
      perc_births_attended <= 100 ~ "76-100",
      TRUE                        ~ ""),
    per_range = factor(per_range, levels = c("0-25", "26-50", 
                                             "51-75", "76-100")),
    text_label = str_c("country: ", country))
```


To do this, we took the `76-100` range and divided it into five smaller ranges and built the same interactive box plot.


```{r bin_top25percent, message=FALSE}
Top_count =
  mortality_births_attend %>% 
  filter(per_range == "76-100") %>%
  mutate(
    top_range = case_when(
      perc_births_attended <= 81 ~ "76-81",
      perc_births_attended <= 85 ~ "82-85",
      perc_births_attended <= 90 ~ "86-90",
      perc_births_attended <= 95 ~ "91-95",
      perc_births_attended <= 100 ~ "96-100",
      TRUE                        ~ ""),
    per_range = factor(per_range, levels = c("76-81", "82-85", 
                                             "86-90", "91-95", "96-100")),
    text_label = str_c("country: ", country)) %>% 
  select(-per_range)
```



### Cesarean Rates
Since the cesarean rates were not directly available from the CDC, we first downloaded the number of births and filtered vaginal and cesearean deliveries in each state. By taking the number of cesarean deliveries and dividing by the total number of births per state, we extrapolated the cesaraean rate for each state. 







## Results







```{r plot_attended, message=FALSE}
mortality_births_attend %>% 
  plot_ly(y = ~maternal_mortality, color = ~per_range, type = "box",
          colors = "Set2", text = ~text_label) %>% 
  layout(
    xaxis = list(title = "Birth Attended by Skilled Staff (% Range)"),
    yaxis = list(title = "Maternal Mortality per 100k Live Births"))
```


As expected, the maternal mortality decreases as births attended by skilled staff increases. Now we will direct our attention to countries with higher percentage of skilled staff attending births. 

```{r, plot_attended_top25percent, message=FALSE}
Top_count %>%
  plot_ly(y = ~maternal_mortality, color = ~top_range, type = "box",
          colors = "Set2", text = ~text_label) %>% 
  layout(
    xaxis = list(title = "Birth Attended by Skilled Staff (%)"),
    yaxis = list(title = "Maternal Mortality per 100k Live Births"))
```

There does not appear to be a significant trend but there is an overall decrease in maternal mortality ratio as the births attendance increases.





## Discussion
