---
title: "comare_healthcare_spending_with_maternal_mortality"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---
# Healthcare spending (%GDP) vs. Country

```{r setup, include = FALSE}
library(tidyverse)
library(rvest)
library(plotly)
library(flexdashboard)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

## Import and clean data
```{r}
# Percent GDP that comes from health spending
health_spending_percent_gdp = read_csv("./data/WorldBank/health_spending_percent_GDP.csv") %>%
  janitor::clean_names() %>% 
  select(country_name, country_code, x2000:x2015) %>% 
  pivot_longer(
  x2000:x2015,
  names_to = "year",
  values_to = "health_spending_percent_GDP") %>% 
  rename("health_spending_percent_gdp" = "health_spending_percent_GDP") %>% 
  mutate(year = str_remove(year,"x")) %>% 
  mutate(health_spending_percent_gdp = round(health_spending_percent_gdp, digits = 2)) %>% 
  mutate(country_name = as.factor(country_name),
         country_code = as.factor(country_code),
         year = as.numeric(year)) %>% 
  rename(country = country_name,
         code = country_code)
```

## Filtered dataset to only include 10 countries in 2013
```{r}
healthcare_spending_2013_developed = 
  health_spending_percent_gdp %>% 
  filter(year == 2013) %>% 
  filter(country %in% c("United States", "United Kingdom", "Finland", 
                           "Canada","Germany", "New Zealand", "Norway", "Netherlands",
                           "Switzerland", "Japan"))
```

## Bar chart (% GDP that comes from healthcare spending in 10 developed countries)
```{r}
ten_developed_countries_health_spending = 
  healthcare_spending_2013_developed %>% 
  mutate(country = as.factor(country),
    country = fct_reorder(country, health_spending_percent_gdp)) %>% 
  ggplot(aes(x = country, y = health_spending_percent_gdp, fill = country)) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(x = "Developed countries",
       y = "% GDP that comes from healthcare spending",
       title = "Different amount of healthcare spending across 10 developed countries")

ggplotly(ten_developed_countries_health_spending)
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart B

#### trying to relate the different amount of healthcare spending across 10 developed countries graph to a manternal mortality graph for the same countries
```{r}
# Maternal Mortality ratio 
maternal_mort = read_csv("./data/Gapminder/maternal_mortality_ratio_per_100000_live_births.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    x1800:x2013,
    names_to = "year",
    values_to = "percent_maternal_mortality"
  ) %>% 
  mutate(year = str_remove(year,"x"))
```

## Filtered dataset to only include 10 countries in 2013
```{r}
maternal_mort_2013_developed = 
  maternal_mort %>% 
  filter(year == 2013) %>% 
  filter(country %in% c("United States", "United Kingdom", "Finland", 
                           "Canada","Germany", "New Zealand", "Norway", "Netherlands",
                           "Switzerland", "Japan"))
```

## Bar chart (maternal mortality in 10 developed countries)
```{r}
ten_developed_countries_maternal_mort = 
  maternal_mort_2013_developed %>% 
  mutate(country = as.factor(country),
    country = fct_reorder(country, percent_maternal_mortality)) %>% 
  ggplot(aes(x = country, y = percent_maternal_mortality, fill = country)) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(x = "Developed countries",
       y = "Maternal mortality",
       title = "Maternal mortality across 10 developed countries")

ggplotly(ten_developed_countries_maternal_mort)
```
